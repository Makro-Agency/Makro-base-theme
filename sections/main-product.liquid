<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"
/>

<section class="product-template">
  <div class="product-container">
    <h1 class="product-title">{{ product.title }}</h1>
    <p class="product-price">
      {% if product.compare_at_price > product.price %}
        <span class="original-price">{{ product.compare_at_price | money }}</span>
        <span class="sale-price">{{ product.price | money }}</span>
      {% else %}
        <span class="current-price">{{ product.price | money }}</span>
      {% endif %}
    </p>
    <p class="product-stock">
      {% if product.available %}
        {% if product.variants.first.inventory_quantity > 10 %}
          <span class="in-stock">In Stock</span>
        {% elsif product.variants.first.inventory_quantity > 0 %}
          <span class="low-stock">Hurry! Only {{ product.variants.first.inventory_quantity }} left in stock!</span>
        {% else %}
          <span class="out-of-stock">Out of Stock</span>
        {% endif %}
      {% else %}
        <span class="out-of-stock">Sold Out</span>
      {% endif %}
    </p>
    <div class="product-description">
      {{ product.description | strip_html | truncate: 200 }}
    </div>
    <form method="post" action="/cart/add">
      <input type="hidden" name="id" value="{{ product.variants.first.id }}" />
  
      {% if product.variants.size > 1 %}
        <label for="variant-select">Choose an option:</label>
        <select name="id" id="variant-select">
          {% for variant in product.variants %}
            <option value="{{ variant.id }}">
              {{ variant.title }} - {{ variant.price | money }}
            </option>
          {% endfor %}
        </select>
      {% endif %}
      <button type="submit" class="btn btn-primary" {% unless product.available %}disabled{% endunless %}>
        {% if product.available %} Add to Cart {% else %} Sold Out {% endif %}
      </button>
      {% if product.available %}
        <button class="btn btn-secondary buy-now" onclick="location.href='/checkout?add={{ product.variants.first.id }}:1'">
          Buy Now
        </button>
      {% endif %}
    </form>
    {% if product.media.size > 0 %}
      <div class="product-media">
        <div class="custom-product-swiper">
          <div class="swiper-wrapper">
        {% for media in product.media %}
          {% case media.media_type %}
            {% when 'image' %}
              <div class="swiper-slide">
              <img src="{{ media.image.src | image_url: width: 500}}" alt="{{ media.alt }}" width="500" height="500">
              </div>
            {% when 'video' %}
              <div class="swiper-slide">
              <video controls>
                <source src="{{ media.src }}" type="video/mp4">
              </video>
            </div>
            {% when 'external_video' %}
              {{ media.external_video.html }}
          {% endcase %}
        {% endfor %}
        </div>
        </div>
      </div>
    {% endif %}
  </div>
</section>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const metafieldDate = "{{ product.metafields.custom.deal_end_date }}";
    if (!metafieldDate) {
      document.querySelector(".custom-countdown").innerHTML = "No deal available!";
      return;
    }
    const targetDate = new Date(metafieldDate).getTime();

    function updateCountdown() {
      const now = new Date().getTime();
      const remainingTime = targetDate - now;
      const days = Math.floor(remainingTime / (1000 * 60 * 60 * 24));
      const hours = Math.floor((remainingTime % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((remainingTime % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((remainingTime % (1000 * 60)) / 1000);



      document.querySelector(".countdown-days").textContent = days < 10 ? "0" + days : days;
      document.querySelector(".countdown-hours").textContent = hours < 10 ? "0" + hours : hours;
      document.querySelector(".countdown-minutes").textContent = minutes < 10 ? "0" + minutes : minutes;
      document.querySelector(".countdown-seconds").textContent = seconds < 10 ? "0" + seconds : seconds;
      if (remainingTime < 0) {
        clearInterval(countdownInterval);
        document.querySelector(".custom-countdown").innerHTML = "Deal Ended!";
        
        document.querySelector(".btn.btn-primary")?.remove(); 
        document.querySelector(".btn.btn-secondary.buy-now")?.remove(); 
      }
    }

    const countdownInterval = setInterval(updateCountdown, 1000);
    updateCountdown();
  });

</script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    var swiper = new Swiper(".custom-product-swiper", {
      navigation: {
        nextEl: ".swiper-button-next",
        prevEl: ".swiper-button-prev",
      },
      loop: true, // Optional: Adds continuous looping.
      slidesPerView: 1, // Adjust as needed.
      spaceBetween: 10, // Adjust spacing.
    });
  });  
</script>

<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js" defer></script>
{% schema %}
{
  "name": "custom-product-template",
  "settings": [],
  "presets": [
    {
      "name": "custom-product-template"
    }
  ]
}
{% endschema %}
