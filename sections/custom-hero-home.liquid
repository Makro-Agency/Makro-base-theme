{{ 'custom-hero-home.css' | asset_url | stylesheet_tag: preload: true }}
{%- style -%}
  #shopify-section-{{section.id}} .cover-image::after {
    opacity: {{section.settings.desktop-overlay}}%;
    content: '';
    position: absolute;
    top: 0;
    background: #000000;
    width: 100%;
    height: 100%;
    border-radius:10px; 
  }
  @media(max-width:767px){
    #shopify-section-{{section.id}} .cover-image::after {
      opacity: {{section.settings.mobile-overlay}}%;
    }
  }

  #shopify-section-{{section.id}} .video_group iframe{
    pointer-events: none;
  }
{%- endstyle -%}
      {%  for block in section.blocks %}
{%- liquid  
  assign loading = 'lazy'
  assign has_first_section = false
  if section.index == 1
    assign loading = 'lazy'
    assign has_first_section = true
  endif
  assign video_id = block.settings.video.id | default: block.settings.video_url.id
  assign video_id_mobile = block.settings.video_moible.id | default: block.settings.video_url_mobile.id
  
  assign video_alt = block.settings.video.alt | default: block.settings.description
  assign alt = 'sections.video.load_video' | t: description: video_alt | escape
  
  assign poster = block.settings.video.preview_image | default: block.settings.cover_image
  assign posterMobile = block.settings.video_moible.preview_image | default: block.settings.cover_image_mobile
  
  assign enable_video_looping = block.settings.enable_video_looping
  
  if block.settings.video != null
    assign ratio_diff = block.settings.video.aspect_ratio | minus: poster.aspect_ratio | abs
    if ratio_diff < 0.01 and ratio_diff > 0
      assign fix_ratio = true
    endif
  endif
  if block.settings.video_mobile != null
    assign ratio_diff_mobile = block.settings.video_video_mobile.aspect_ratio | minus: posterMobile.aspect_ratio | abs
    if ratio_diff_mobile < 0.01 and ratio_diff_mobile > 0
      assign fix_ratio_mobile = true
    endif
  endif

  assign sizes = '100vw'
-%}
{% assign video_url = block.settings.video_url %}
{% if has_first_section %}
  {%- if block.settings.video == null and video_url != null -%}
    {%- if video_url.type == 'vimeo' -%}        
      <link rel="preconnect" href="https://player.vimeo.com/">
      {%- if block.settings.video_url_mobile != blank -%}
        <link rel="preload" href="https://player.vimeo.com/video/{{ block.settings.video_url_mobile.id }}?autoplay=1&muted=1{{ loop }}&background=1&transparent=0" as="document" media="(max-width: 749px)">
        <link rel="preload" href="https://player.vimeo.com/video/{{ video_id }}?autoplay=1&muted=1{{ loop }}&background=1&transparent=0" as="document" media="(min-width: 750px)">
      {%- else -%}
        <link rel="preload" href="https://player.vimeo.com/video/{{ video_id }}?autoplay=1&muted=1{{ loop }}&background=1&transparent=0" as="document" media="(min-width: 750px)">
      {%- endif -%}
    {% endif %}
  {% endif %}
{% endif %}
      {% endfor %}
       <div class="custom-block swiper">
        <div class="swiper-wrapper">
      {%  for block in section.blocks %}
<div class="swiper-slide title_video_wrapper {{ block.settings.videoLayout }}"> 
  <custom-deferred-media2 class="cust-autoplay-video video_group{% if block.settings.enable_autoplay %} autoplay-enabled{% endif %}">
    <div class="cover-image">
      {% if posterMobile != blank %}
        {% assign pclass = 'img-desktop' %}
      {% endif %}
      {%- if poster != null -%}
        {{ poster
          | image_url: width: 3840
          | image_tag: loading: 'lazy', sizes: sizes, widths: '375, 750, 1100, 1500, 1780, 2000, 3000, 3840', alt: alt, class: pclass
        }}
      {%- else -%}
        {{ 'hero-apparel-3' | placeholder_svg_tag: 'placeholder-svg placeholder' }}
      {%- endif -%}
      {%- if posterMobile != null -%}
        {{ posterMobile
          | image_url: width: 750
          | image_tag: loading: 'lazy', sizes: sizes, widths: '375, 750, 1100', alt: alt, class: 'img-mobile'
        }}      
      {%- endif -%}      
      <button type="button" class="play-button video-wrapper__play-button video-wrapper__play-button--ripple">
        <svg xmlns="http://www.w3.org/2000/svg" width="120" height="120" viewBox="0 0 120 120" fill="none">
          <path opacity="0.4" fill-rule="evenodd" clip-rule="evenodd" d="M60 120C93.1371 120 120 93.1371 120 60C120 26.8629 93.1371 0 60 0C26.8629 0 0 26.8629 0 60C0 93.1371 26.8629 120 60 120ZM51.5294 77.1167L79.0588 61.2226C80 60.6792 80 59.3208 79.0588 58.7774L51.5294 42.8833C50.5882 42.3399 49.4118 43.0191 49.4118 44.1059V75.8941C49.4118 76.9809 50.5882 77.6601 51.5294 77.1167Z" fill="white"/>
        </svg>
      </button>      
    </div>    
    <template>
      {%- if block.settings.video == null and block.settings.video_url != null -%}
        {%- liquid
          assign loop = ''          
          if enable_video_looping
            assign loop = '&loop=1&playlist=' | append: video_id
          endif
        -%}
        {%- if block.settings.video_url.type == 'youtube' -%}
          <iframe
            src="https://www.youtube.com/embed/{{ video_id }}?enablejsapi=1&autoplay=1&mute=1{{ loop }}&rel=0&controls=0&modestbranding=1&showinfo=0&autohide=1"
            class="js-youtube"
            loading="lazy"
            data-ready="true"
            allow="autoplay; encrypted-media"
            allowfullscreen loading="{{ loading }}"
            title="{{ block.settings.description | escape }}"
          ></iframe>
        {%- else -%}
          <iframe
            src="https://player.vimeo.com/video/{{ video_id }}?autoplay=1&muted=1{{ loop }}&background=1&transparent=0"
            class="js-vimeo"
            allow="autoplay; encrypted-media"
            allowfullscreen loading="{{ loading }}"
            loading="lazy"
            data-ready="true"
            title="{{ block.settings.description | escape }}"
            width="600" height="400"
          ></iframe>
        {%- endif -%}
        
      {%- else -%}
        {{
          block.settings.video
          | video_tag:
            image_size: '1100x',
            autoplay: true,
            loop: enable_video_looping,
            controls: true,
            muted: true
        }}
      {%- endif -%}
      
      {%- if block.settings.video_mobile == null and block.settings.video_url_mobile != blank -%}
        {%- liquid
          assign loop = ''
          if enable_video_looping
            assign loop = '&loop=1&playlist=' | append: video_id_mobile
          endif
        -%}
        {%- if block.settings.video_url_mobile.type == 'youtube' -%}
          <iframe
            src="https://www.youtube.com/embed/{{ video_id_mobile }}?enablejsapi=1&autoplay=1&mute=1{{ loop }}&rel=0&controls=0&modestbranding=1&showinfo=0&autohide=1"
            class="js-youtube js-mobile-video"
            allow="autoplay; encrypted-media"
            allowfullscreen loading="{{ loading }}"
            title="{{ block.settings.description | escape }}"
          ></iframe>
        {%- else -%}
          <iframe
            src="https://player.vimeo.com/video/{{ video_id_mobile }}?autoplay=1&muted=1{{ loop }}&background=1&transparent=0"
            class="js-vimeo js-mobile-video"
            allow="autoplay; encrypted-media"
            allowfullscreen loading="{{ loading }}"
            title="{{ block.settings.description | escape }}"
            width="600" height="400"
          ></iframe>
        {%- endif -%}
      {% else %}

        {{
          block.settings.video_mobile
          | video_tag:
            image_size: '750x',
            autoplay: true,
            loop: enable_video_looping,
            controls: true,
            muted: true,
            class: 'js-mobile-video'
        }}
      {%- endif -%}
    </template>
  </custom-deferred-media2>
  <div class="video_title">
    {%- if block.settings.title != blank -%}
      <h2 class="main_heading h2">{{ block.settings.title }}</h2>
    {%- endif -%}
    <div class="description-wrapper"> 
      {%- if block.settings.detail != blank -%}
        <p class="desc">{{ block.settings.detail }}</p>
      {%- endif -%}
      {%- if block.settings.btn_text != blank -%}
        <a href="{{ block.settings.url | default: '#' }}" class="button btn-primary">{{ block.settings.btn_text }}</a>
      {%- endif -%}
    </div>
  </div>
</div>
{%  endfor %}
   </div>
  </div>
 <script>
   document.addEventListener("DOMContentLoaded", (event) => {
    var swiper = new Swiper(".custom-block", {
        slidesPerView: 1,
        spaceBetween: 10,        
        navigation: {
          nextEl: ".testimonial-section .swiper-button-next",
          prevEl: ".testimonial-section .swiper-button-prev",
        },
        scrollbar: {
          el: ".swiper-scrollbar",
          hide: false,
        },
        breakpoints: {
          0: {
            autoHeight: true,
          },
          
          640: {
            slidesPerView: "1",
            spaceBetween: 20,
            loop: true,
          },
          768: {
            slidesPerView: "2",
            spaceBetween: 30,
          },
          1201: {
            slidesPerView: "3",
            spaceBetween: 30,
          },
          1440: {
            slidesPerView: "3",
            spaceBetween: 30,
          },
        },
     });
  }); 
              class CustomDeferredMedia2 extends HTMLElement {
  constructor() {
    super();
    this.playButton = this.querySelector('.play-button');
    this.autoplayEnabled = this.classList.contains('autoplay-enabled');
    this.videoElement = null;

    // Initialize the content based on autoplay setting
    if (this.autoplayEnabled) {
      this.loadContent();
    } else {
      this.setupPlayButton();
    }
  }

  setupPlayButton() {
    this.playButton.addEventListener('click', () => {
      this.loadContent(true);
      this.playButton.style.display = 'none'; // Hide play button after clicking
    });
  }

  loadContent(focus = true) {
    window.pauseAllMedia?.(); // Ensure this method is safe to call if defined
    if (!this.getAttribute('loaded')) {
      const content = document.createElement('div');
      if (
        window.innerWidth < 750 &&
        this.querySelector('template').content.querySelector('.js-mobile-video')
      ) {
        content.appendChild(
          this.querySelector('template').content
            .querySelector('.js-mobile-video')
            .cloneNode(true)
        );
      } else {
        content.appendChild(
          this.querySelector('template').content.firstElementChild.cloneNode(
            true
          )
        );
      }

      this.setAttribute('loaded', true);
      this.videoElement = this.appendChild(
        content.querySelector('video, model-viewer, iframe')
      );

      if (this.videoElement.nodeName === 'VIDEO') {
        this.videoElement.setAttribute('playsinline', true);
        this.videoElement.muted = true; // Muted for autoplay compatibility

        if (this.autoplayEnabled) {
          this.videoElement.autoplay = true;
          this.videoElement.play().catch((error) => {
            console.error('Autoplay failed:', error);
          });
        }
      }

      if (focus) this.videoElement.focus();
    }
  }
}

customElements.define('custom-deferred-media2', CustomDeferredMedia2);
 </script>
      
{% schema %}
  {
    "name": "Home Page Hero",
    "class": "section",
    "disabled_on": {
      "groups": ["header", "footer"]
    },
    "settings": [
  
    ],
        "blocks": [
      {
        "type": "video",
        "name": "Tip",
        "limit": 4,
        "settings" : [
          {
          "type": "image_picker",
          "id": "icon",
          "label": "Benefit Icon"  
           },
            {
      "type": "checkbox",
      "id": "enable_autoplay",
      "label": "Enable Autoplay",
      "default": false
    },  
    {
      "type": "checkbox",
      "id": "enable_video_looping",
      "label": "Play video on loop",
      "default": false
    },
    {
      "type": "header",
      "content": "Shopify-hosted video"
    },
    {
      "type": "video",
      "id": "video",
      "label": "Video"
    },
    {
      "type": "video",
      "id": "video_mobile",
      "label": "Mobile video"
    },
    {
      "type": "header",
      "content": "Or embed video from URL"
    },
    {
      "type": "paragraph",
      "content": "Shows when no Shopify-hosted video is selected."
    },
    {
      "type": "video_url",
      "id": "video_url",
      "accept": ["youtube", "vimeo"],
      "default": "https://www.youtube.com/watch?v=_9VUPq3SxOc",
      "label": "URL",
      "info": "Use a YouTube or Vimeo URL"
    },
    {
      "type": "video_url",
      "id": "video_url_mobile",
      "accept": ["youtube", "vimeo"],
      "default": "https://www.youtube.com/watch?v=_9VUPq3SxOc",
      "label": "Mobile URL",
      "info": "Use a YouTube or Vimeo URL"
    },
    {
      "type": "image_picker",
      "id": "cover_image",
      "label": "Cover image"
    },
    {
        "type": "range",
        "min": 0,
        "max": 100,
        "step": 5,
        "unit": "%",
        "id": "desktop-overlay",
        "label": "Overlay",
        "default": 0
    },
    {
      "type": "image_picker",
      "id": "cover_image_mobile",
      "label": "Cover image for mobile"
    },
    {
      "type": "range",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "%",
      "id": "mobile-overlay",
      "label": "Overlay",
      "default": 0
      },
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "SOLUTIONS FOR QUICKLY AND EASILY ACHIEVING YOUR HAIRSTYLE AT HOME"
    },
    {
      "type": "inline_richtext",
      "id": "detail",
      "label": "Detail",
      "default": "Worem ipsum dolor sit amet, consectetur adipiscing elit. Etiam eu turpis molestie, dictum est a, mattis tellus. Sed dignissim, metus nec fringilla accumsan, risus sem sollicitudin lacus, ut interdum tellus elit sed risus. Maecenas eget condimentum velit, sit amet feugiat lectus."
    },
      {
        "type": "header",
        "content": "Button"
      },
      {
        "type": "text",
        "label": "Button text",
        "id": "btn_text",
        "default": "Shop Now"
      },
      {
        "type": "url",
        "label": "Button link",
        "id": "url"
      }
        ]
      }
    ],
    "presets": [
      {
        "name": "Custom Hero home"
      }
    ]
  }
{% endschema %}